---
- name: Configure | license_key
  lineinfile:
    state: present
    dest: /etc/newrelic/nrsysmond.cfg
    regexp: '^#* *license_key'
    line: 'license_key=***REMOVED***'
  tags:
    - configuration
    - precise-configuration
    - external-service
    - newrelic

- name: Configure | proxy
  lineinfile:
    state: present
    dest: /etc/newrelic/nrsysmond.cfg
    regexp: '^#* *proxy'
    line: "proxy={{ newrelic_proxy_address }}:{{ newrelic_proxy_port }}"
  when: newrelic_proxy_required
  tags:
    - configuration
    - precise-configuration
    - external-service
    - newrelic

- name: Install NewRelic using NewRelic installer with license key
  shell: newrelic-install install
  args:
    executable: /bin/bash
  notify: Reload Service | php5-fpm
  when: newrelic_php_apm_enabled
  tags:
    - monitoring
    - using-newrelic
    - php
